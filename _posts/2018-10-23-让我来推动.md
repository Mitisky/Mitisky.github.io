---
layout: post
title:  "让我来推动"
date:   2018-10-23  +0800
categories: thinking
---


# 让我来推动

我们作为一个主力开发人员，经常会有一些重构某部分功能，提供了一套新的工具，或者实现了一套很好用的中间件工具，我们肯定都会希望我们的代码产品能够被更多的同事使用。那么如何让这些代码产品更好落地就非常重要。我这里聊一聊对于如何推动一个代码产品的落地的一些个人的思考。这里的代码产品可能是一个测试框架，一套通用的中间件，又或者是某个独立的功能等等。

代码上的开发完成其实离真正的完成还有不少的距离。真正的完成，我觉得应该包含下面几个方面

* 简单易用，能提供丰富的文档，包括使用文档，相应的异常处理文档
* 异常情况处理流程
* 有很好的项目落地，或者成效


前两点不难理解，他们软件生命周期中的维护部分。而最后一点可能会充满疑问。有很好的落地，这本质上来说是对产品价值的体现。我们要做有价值的事情，没有价值的事情又怎么会有存在的必要呢？产生价值是产品的目的，故而最后一点我觉得至关重要。而前两点关于软件文档和维护上，我倒是认为是推动落地，产生价值的方式。当项目落地产生价值，同时有维护流程来保证长期稳定运行。这个产品就算成了。

软件工程中在软件项目实施过程首先要做的就是需求分析。我做一套自己的代码产品的前提也是需求。我需要这些代码产品，这些产品才有存在的意义。

我通过我推动的分布式数据分析软件产品中的自动化测试来说说我的思考。在软件开发初期，由于赶进度，测试非常不成熟，简单的集成测试需要构造非常多的对象，而也只能单机的运行。这些是存在的问题，同时也提供了我的需求。

于是我增加了一个测试框架。提供了测试数据的准备，同时做到开发写一套代码，单机和集群模式随意切换。这个是一个不是很复杂的工具，但是当时就产生了很大的价值，发现了不少的集群下单代码 bug。
仅仅有这个工具还是远远不够的。因为当前这个办法测试通过了，下个版本挂了一半。究其原因还是我们的测试没有起点很好的维护代码正确性的作用。不知道猴年马月想起来才执行测试代码。因此我们必须要自动化测试。为此，我将我们已有的测试代码区分为

* 宽泛的单元测试
* 宽泛的集成测试


区别的目的是为了控制代码运行时间，能做到有异常问题快速反馈（虽然现在没有这么做，但是快速反馈的确非常重要，下面会说到）。只有是无需跑分布式环境的代码统统认为是单元测试，为的就是能快速运行结束，立刻告知结果。

申请4台机器，3台搭建一个分布式集群环境用作测试环境。1台运行 jenkins。 按照下面的流程，我们把自动化测试的雏形搭了出来

* 每次有人提交代码，触发 jenkins 拉取代码
* 运行单元测试，有问题终止，并发送邮件给团队全员
* 定期执行集成测试，运行单机和分布式环境的代码，有问题同样发生给团队全员


整个系统包括调整代码，处理分布式问题，搭建系统调试，前后工作量应该有15个人天左右。满心欢喜期望着发光发热，但是不到半个月，jenkins系统被人误关了却无人知晓。

后来总结原因有以下几点

* 当时系统根本无法做到无需运维，因此必要得有人维护
* 发送全团队的邮件，这样的邮件等于无效的邮件，大家每次都被与自己无关的事情打扰多了，本能屏蔽了这些邮件。也就是需要上面提到的快速反馈

于是针对上述的原因，我对系统进行了改进。

* 增加了一个 Monitor 工具，监控 Jenkins 的运行状态，只有Jenkins没有运行，就启动。
* 将邮件统一发给一个同事，同时附上这轮提交代码的人员信息。同事在工作群中，@到人提醒他们提交的代码可能有问题。


上面改进的工作量不多。但是搭进去一个同事，可能被邮件侵扰。这里这么做的其实是一个折中做法。因为做到精准定位问题是由谁提交导致的花费的工作量就会很多。但是搭进去一个同事，每天也不会花费很多的时间，却可以让整个系统运作起来，我觉得是值得的。这也是我推动项目的办法，**快速执行，反映成效**。后续效果显著，我也非常愿意投入时间来完成自动定位到问题代码的提交者。效果不显著，我的损失也不大，我还有足够的时间来调整。至于在工作群中@到人，完全是为了迫使相关人员要足够重视，毕竟人都是有惰性的。

现在效果很好问题不多，因为提交者被@多了，也会自己主动运行单元测试，这样收到问题邮件也不是很多。

目前这一整套框架，包括了很多测试类型，逐渐又开始臃肿起来，一次测试时间越来越长。下面需要的事情就是环境隔离，谁提交谁解决。
同时还要解决的是代码统计问题，确保开发人员提交足够的测试代码。这些我愿意花费时间来做，因为已经产生了价值，值得投入。













